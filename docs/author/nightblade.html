<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="nightblade" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="Deen Games Blog - nightblade"/>
    <meta property="og:url" content="https://www.deengames.com/blog/author/nightblade.html"/>
    <meta property="og:site_name" content="Deen Games Blog"/>
    <meta property="og:type" content="website"/>

    <link rel="canonical" href="https://www.deengames.com/blog/author/nightblade.html" />

    <title>Deen Games Blog - nightblade | Deen Games Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="https://www.deengames.com/blog/theme/css/main.css" />
    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Deen Games Blog Atom Feed" />
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span9">
            <header id="banner" >
                <h1>
                    <a href="https://www.deengames.com/blog/">Deen Games Blog </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li><a href="https://www.deengames.com/blog/pages/about.html">About</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/devlog.html">Devlog</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/news.html">News</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/other.html">Other</a></li>
                        </ul>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>

        <div class="row-fluid">
            <div class="span9">
                <div class="row-fluid">
<div class="span9">
                <section>
                    <ol id="posts-list" class="hfeed" start="4">
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2021/blog-reboot.html" rel="bookmark" title="Permalink to Blog Reboot">
                                       Blog Reboot
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/news.html">News</a>

    on 2021-03-18




    
</footer><!-- /.post-info -->                                <p><img src="https://i.imgur.com/qXNDPKB.png" width="672" height="378" alt="sign that says: changes ahead" /></p>
<p>Hello! Long-time readers of this blog may notice a couple of changes:</p>
<ul>
<li>A new, mobile-responsive theme</li>
<li>A complete restructuring of content</li>
</ul>
<p>I decided to redo the blog to make it mobile-friendly, and to hange the content - instead of game development notes and game design articles, instead, I plan to focus on my games.</p>
<p>What can you expect going forward? Weekly posts show-casing the best of whatever current project I'm working on.</p>
<p>Old articles will stay available for a while.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2020/web-application-translation-architecture-in-net.html" rel="bookmark" title="Permalink to Web Application Translation Architecture in .NET">
                                       Web Application Translation Architecture in .NET
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2020-08-11




    
</footer><!-- /.post-info -->                                <p>Tags: .NET Core, Architecture</p>
<p><img alt="globe of languages" src="https://i.imgur.com/bqyLzs1.png?1"></p>
<p>So you want to localize and internationalize your web application? There are a lot of considerations, but here, we briefly discuss just the translation part.</p>
<p>This post covers a couple of the architectural/design options and discusses their respective trade-offs. While this is a bit specific to .NET, other languages no doubt provide similar concepts, with various levels of API support (e.g. language stored in cookies)</p>
<h1>Individual Translations via RESX Files</h1>
<p>.NET and .NET Core provide some infrastructure called "resource files" (<code>.resx</code>) extension). These are XML files which you can edit directly in Visual Studio; at runtime, they compile down to a binary format. They generally recommend creating a few resource files (one per back-end controller or shared module). Advantages of this approach include:</p>
<ul>
<li>Easy editing of the file (in-IDE)</li>
<li>Easy versioning/history of the file (it's a text format)</li>
<li>API support for configuring the prefered language in a cookie, etc.</li>
<li>Localized changes on translation change (no need to re-test everything)</li>
<li>Efficient, with a small size at runtime</li>
</ul>
<p>The disadvantages of this format include:</p>
<ul>
<li>Any translation change requires recompiling the entire application</li>
<li>Editing dozens of files can be very cumbersome</li>
<li>Difficult to make a translation change and see it immediately in-app (unless you're a developer)</li>
<li>You can't store any sort of metadata (e.g. notes) with translations</li>
</ul>
<p>Overall, I think this approach works well if you plan to update translations periodically and don't need an external translater. (If you do, and they're not a coder, you'll need to make additional tooling to export/import the strings in a format they can understand.)</p>
<h1>Using a Database for Translations</h1>
<p>One common alternative approach is to store the translations in a database (relational or otherwise) and simply load/display them at runtime. This confers some additional advantages over resource files:</p>
<ul>
<li>Ability to update a translation and instantly see the change in-app</li>
<li>Ability to store meta-data (like notes) with each message</li>
<li>You can quickly query to find missing strings in various languages</li>
<li>Non-technical users can easily edit translations via a simple web UI</li>
</ul>
<p>However, it contains some additional downsides:</p>
<ul>
<li>You need to write a web UI to allow translators to be able to view/update translations</li>
<li>Making several database calls just to load one view/page, can be costly in terms of performance</li>
<li>You can read/cache strings in memory on app-start, but then your app requires additional memory per language</li>
</ul>
<p>I think this approach suits situations where you absolutely must be able to see updated translations reflected immediately, or where you have non-technical translators who need an easy way to be able to update translations.</p>
<p>If you know of any other architectures/designs, drop me a note <a href="https://twitter.com/nightblade99">on Twitter</a> and let me know!</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2020/thoroughly-testing-your-game.html" rel="bookmark" title="Permalink to Thoroughly Testing Your Game">
                                       Thoroughly Testing Your Game
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2020-07-07




    
</footer><!-- /.post-info -->                                <p>Tags: Planning, Testing</p>
<p><img alt="2 unit tests, 0 integration tests" src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fimg.devrant.com%2Fdevrant%2Frant%2Fr_519301_QxQcw.gif&amp;f=1&amp;nofb=1"></p>
<h1>Why Test?</h1>
<p>Of all the fun, interesting, exciting game development topics I could write about, I chose: testing.</p>
<p>Why?</p>
<p>Because testing is <em>essential</em> to shipping your game without bugs and without hours upon hours of manual effort. As we'll see shortly, there are well-known patterns and practices you can apply; some generic to softwre testing, and some specific to game testing. </p>
<p>I discovered these practices after working more then a decade as a professional software developer, and applying them on and off for a decade as a hobbyist game developer. They take time, yes. They work, often and they're better (faster, more reliable, consistent) than manual testing.</p>
<h1>Overall Strategy</h1>
<p>Your goal with software testing is to release your game at the highest possible quality: that means NO BUGS! Everything should work the way the designers intended, <em>without</em> us spending tons of manual hours play-testing the same parts over and over and over (yawn).</p>
<p>Your overall strategy needs to include the following categories:</p>
<ul>
<li><strong>Unit Testing:</strong> So you know your methods/classes/scripts/objects work at a granular level.</li>
<li><strong>System Testing:</strong> Make sure cross-object workflows succeed, like "user last-shots an enemy and gets bonus gold." Sometimes called integration testing, functional testing, or end-to-end testing.</li>
<li><strong>Regression Testing:</strong> Every bug you find and catch should be exploited by a unit test. If that test passes, it guarantees the bugs won't repeat.</li>
<li><strong>Exploratory Testing:</strong> There's no substitute for playing your game and trying weird stuff. You'll find quirks and things that your automated tests won't catch.</li>
</ul>
<p>Without these fundamentals, be prepared for lots of bugs and poor game reviews! Above and beyond them, depending on your available time, skill, and interest, you may benefit from additional categories:</p>
<ul>
<li><strong>Balancing:</strong> Write tests that make sure the game is balanced, e.g. each class has roughly the same DPS, or that dungeons generate with roughly the right progressive difficulty</li>
<li><strong>Performance or Crash Testing:</strong> Running previously-problematic code and making sure it's fast or doesn't crash. This includes running your game overnight to see if bad things happen.</li>
</ul>
<p>I can't reasonably explain all those topics in a suitable depth without writing an essay, but get in touch with me if you would like more information on these topics.</p>
<h1>Testing Process</h1>
<p>Regardless of how little or how much you utilize the above categories of testing, you <em>need</em> to properly test your game whenever you make a change. Properly means: sufficiently testing those areas that <em>may</em> be affected, to make sure they still work as expected.</p>
<p>After all, global variables are still a thing. Singletons can easily be accessed from anywhere. Highly-coupled code is common in (and out) of games. You need to make sure you didn't break stuff by mistake.</p>
<p>How? Simple; but it all depends on two things:</p>
<ul>
<li>You have a continuous integration setup which builds on every commit</li>
<li>You have a way of producing a final kit (installer, standalone executable, etc.) that you're going to ship</li>
</ul>
<p>Let's start with baby steps. Whenever you make a code change:</p>
<ul>
<li>Write unit tests</li>
<li>Run all unit tests continuously (before you check in)</li>
<li>Have a continuous integration solution (e.g. Jenkins, Travis-CI) build your code and run tests every commit</li>
</ul>
<p>This makes sure your code works (very granularly, at a class/scene/script method) and that you didn't break anything in an unrelated area. Good unit testing usually uncovers bugs (while you're writing the test code). They run fast (sub-second), so you can test lots of things quickly.</p>
<p>If you have integration/functional/system tests, they're usually slower (seconds each), but highly valuable, since they're like a mini version of your game in some scenario/situation. Run those as part of the build, too.</p>
<p>After the build runs, it generates a playable binary of some sort. Against this, you want to properly test the new feature/change/fix you just added. Like, <em>properly</em>, including things leading up to it and things after it should have happened.</p>
<p>With this done, you can be reasonably sure your game works, assuming you have good coverage of unit, regression, and system tests. You may want to run some exploratory tests: mess around and see if you can find anything or break anything.</p>
<h1>Release-Time Testing Process</h1>
<p>Your game is done, hurray! Congratulations! Now, the fun part: testing your game before you ship it. Since you have a robust build system in place, take the binaries from a passing build, and test it.</p>
<p>The best way to know if your game is likely ready, is:</p>
<ul>
<li>Play it from beginning to end</li>
<li>Stop and fix any bugs you find, verifying them through the build binaries</li>
<li>Depending on the game length, either start over, or finish the run</li>
</ul>
<p>Repeat this until you can complete the game without finding anything to fix.</p>
<p>Also, when you find a bug, you don't need to re-test <em>everything</em>; you can re-test <em>just</em> the affected area (e.g. inventory management) and any other areas that might be affected because of shared/common/global code (e.g. item crafting).</p>
<h1>Balancing, Performance and Crash Testing</h1>
<p>If you write tests for balancing (make sure monsters, or skills, or levels, etc. are balanced with respect to each other), performance (make sure a certain part of the game runs fast enough), or crash (exercise a workflow and check it doesn't crash) testing, you can run them as little or as much as you like.</p>
<p>I recommend running them at least weekly or per-sprint, to make sure nothing broke unexpectedly. If you have a good CI system and don't mind longer test runs, you can run them as part of the CI.</p>
<h1>Conclusion</h1>
<p>Testing is expensive! It takes time and effort! Write tests, debug tests, update tests! Anyone who tried this process will likely tell you <em>it's worth it</em>. The pay-off of pressing a button or pushing a commit, and having <em>confidence</em> that your game works, in every way you tested, is well worth the effort.</p>
<p>Don't be daunted. Take baby steps. Practice. Ask questions. Try to add a bit more to each new project you start, so you can eventually master all these skills. They take time.</p>
<p>If you ever want a second opinion or sounding board, or have questions or comments, feel free to reach out to me <a href="https://twitter.com/nightblade99">on Twitter</a> or <a href="https://discord.gg/frKXYtG">Discord</a>.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2020/a-primer-on-aabb-collision-resolution.html" rel="bookmark" title="Permalink to A Primer on AABB Collision Resolution">
                                       A Primer on AABB Collision Resolution
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2020-01-30




    
</footer><!-- /.post-info -->                                <p>Tags: Physics</p>
<p><img alt="video demo" src="https://i.imgur.com/GLQzqUP.gif"></p>
<p>This blog post includes a discussion about AABB collision resolution: what it is and isn't, it's strengths and weaknesses, some common pitfalls, and how you can (hopefully) implement it in your low-level gaming tool of choice, if needed.</p>
<p>I learned all this (the second time) as part of adding fast/stable collision resolution to <a href="https://nightblade9.github.io/puffin">Puffin</a>, a fast, lightweight 2D game engine built on top of MonoGame.</p>
<h2>AABB, Collision Detection, and Collision Resolution</h2>
<p>Some quick definitions to start:</p>
<ul>
<li>AABB (Axis Aligned Bounding Boxes) means two non-rotated boxes, that are aligned on one axis. In 2D, everything on the same "layer" or "z" is on the same axis; in 3D, it means your boxes are on the same plane.</li>
<li>Collsiion detection means detecting if there is a collision (two AABBs overlapping) or will be a collision (eg. in 0.3s these two will start colliding).</li>
<li>Collision resolution means resolving the collision. Broadly, there are two approaches to this: prevention or pre-collision resolution (stop just at the onset of collision when the two AABBs touch), and post-collision resolution (once two AABBs overlap, move them backward in time until they no longer overlap).</li>
</ul>
<p>My approach to AABB uses pre-collision resolution, because it tends to be less complex and more stable.</p>
<h2>Pros and Cons of AABB</h2>
<p>Why should you use AABB collision resolution? There are many other options, such as collision points, sphere/line collsion algorithms, polygons, etc.</p>
<p>The strengths of AABB include:</p>
<ul>
<li>It works well in most cases. Most games can do well enough with just bounding boxes on their entities.</li>
<li>It's relatively simple to code (math-wise), because it's just boxes.</li>
<li>It's quite cheap computationally (eg. doesn't have an expensive square-root calculation, unlike spherical checks)</li>
</ul>
<p>However, it includes some drawbacks:</p>
<ul>
<li>It doesn't work with rotated boxes</li>
<li>It doesn't work well with non-box shapes</li>
<li>It requires extra work for it to work well with multi-entity collisions</li>
<li>It's succeptible to "tunnelling" (high-speed objects move through solid objects because of their velocity)</li>
</ul>
<p>If you can live with those limitations, I recommend AABB, primarily because it is computationally cheap (works well with a high number of colliding entities).</p>
<h2>Collision Resolution is Complex, like Physics</h2>
<p>While AABB collision resolution is <em>relatively</em> easier to code, it doesn't mean it's <em>easy</em> to code. Many game frameworks don't include collision resolution, because this is part of the physics engine.</p>
<p>Read that again: it's often part of the <em>physics engine</em>. Physics engines are notoriously difficult to get right, and require lots of fiddling and corner-case evaluation. Even high-quality physics engines have limitations, such as tunneling.</p>
<p>It took me around 10 hours to discover all the caveats and get this to work right. And it works well, including with multi-entity collisions. Test thoroughly.</p>
<p>That said, my implementation includes a few bonus features:</p>
<ul>
<li>It's resistant to collision tunneling (but not impervious)</li>
<li>It works with multiple objects colliding at the same time</li>
<li>It allows an object to optionally "collide and slide" along the object it collides with</li>
</ul>
<p>With that out of the way, let's dive into the actual theory of how to make a stable AABB resolution, and then some code.</p>
<h2>High-Level Description of AABB</h2>
<p>AABB collision resolution works by looking at the X and Y component resolutions of your velocity. Simply put:</p>
<ul>
<li>Consider the intended destination of your moving entity (where it will be after updating its position, not where it is now)</li>
<li>Look at the distance <code>dx</code> to travel before we collide on the X-axis and <code>dy</code> for the Y-axis</li>
<li>Divide these by your component X-velocity and Y-velocity respectively (<code>vx</code> and <code>vy</code>) to figure out how long before each axis collision takes place (<code>tx</code> and <code>ty</code>)</li>
<li>Resolve the collision on the axis that collides first</li>
</ul>
<p><img alt="AABB sweep test with velocity" src="https://i.imgur.com/gCtzUeJ.png"></p>
<p>This excellent diagram (credit: LaroLaro on <a href="https://gamedev.stackexchange.com/questions/28577/2d-aabb-vs-aabb-sweep-how-to-calculate-hit-normal">GameDev.SE</a>) shows a moving object (A) that will collide with a second object (B). Based on the component velocities, you can see from the projected A box that the faster collision will be on the Y-axis first.</p>
<p>Because collision resolution takes place on a single axis at a time, you may end up having to resolve the same collision multiple times to get a stable resolution. I find that running the collision resolution twice suffices.</p>
<h2>And Now, the Code</h2>
<p>Below, I discuss some pseudocode that's almost the same as the actual (C#) code from Puffin. The same code can apply to any programming language or framework.</p>
<p>One unorthodox implementation detail I used: when each entity moves, I make a note of their "intended" destination X/Y. If that location would cause it to collide inside an object, I instead update it so it stops just at the point of collision.  In my pseudocode below, you'll see this as <code>intendedX</code> and <code>intendedY</code>.</p>
<p>For every collidable entity, you're going to compare it to every other collidable entity. Since we're using AABBs, this is pretty simple: just compare the coordinates plus intended movement of the moving entity, against the entity that isn't moving:</p>
<div class="highlight"><pre><span></span><code><span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">isAabbCollision</span><span class="p">(</span><span class="kt">float</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Adapted from https://tutorialedge.net/gamedev/aabb-collision-detection-tutorial/</span>
    <span class="k">return</span> <span class="n">x1</span> <span class="p">&lt;</span> <span class="n">x2</span> <span class="p">+</span> <span class="n">w2</span> <span class="p">&amp;&amp;</span>
        <span class="n">x1</span> <span class="p">+</span> <span class="n">w1</span> <span class="p">&gt;</span> <span class="n">x2</span> <span class="p">&amp;&amp;</span>
        <span class="n">y1</span> <span class="p">&lt;</span> <span class="n">y2</span> <span class="p">+</span> <span class="n">h2</span> <span class="p">&amp;&amp;</span>
        <span class="n">y1</span> <span class="p">+</span> <span class="n">h1</span> <span class="p">&gt;</span> <span class="n">y2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>You simply call this with <code>e1.x + e1.velocity.x, e1.y + e1.velocity.y, e1.width, e1.height, e2.x, e2.y, e2.width, e2.height</code> and it will return if they collide or not.</p>
<p>However, to stop at the point of collision, we need to consider our entity's velocity: if it's moving right, then the distance to collide on the X-axis is the right edge of <code>e1</code> compared to the left-edge of <code>e2</code>. If it's moving left, then vice-versa (left edge of <code>e1</code> vs. the right edge of <code>e2</code>). The same thing applies when we resolve on the Y-axis.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Assuming we have two AABBs, what&#39;s the actual distance between them?</span>
<span class="c1">// eg. if `e1` is on the left of `e2`, we want `dx` to be `e2.left - e1.right`.</span>
<span class="k">private</span> <span class="nf">static</span> <span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="n">CalculateAabbDistanceTo</span><span class="p">(</span><span class="n">Entity</span> <span class="n">e1</span><span class="p">,</span> <span class="n">Entity</span> <span class="n">e2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">dx</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">dy</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span> <span class="p">&lt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dx</span> <span class="p">=</span> <span class="n">e2</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> <span class="n">e1</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">X</span> <span class="p">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">X</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dx</span> <span class="p">=</span> <span class="n">e1</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="p">(</span><span class="n">e2</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> <span class="n">e2</span><span class="p">.</span><span class="n">Width</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span> <span class="p">&lt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dy</span> <span class="p">=</span> <span class="n">e2</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span> <span class="p">+</span> <span class="n">e1</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">Y</span> <span class="p">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dy</span> <span class="p">=</span> <span class="n">e1</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="p">(</span><span class="n">e2</span><span class="p">.</span><span class="n">Y</span> <span class="p">+</span> <span class="n">e2</span><span class="p">.</span><span class="n">Height</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Then, for every collidable entity, if it results in an AABB collision with another collidable entity, we figure out which axis collides first, based on which one collides first time-wise:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Another entity occupies that space. Use separating axis theorem (SAT)</span>
<span class="c1">// to see how much we can move, and then move accordingly, resolving at whichever</span>
<span class="c1">// axis collides first by time (not whichever one is the smallest diff).</span>
<span class="p">(</span><span class="kt">float</span> <span class="n">xDistance</span><span class="p">,</span> <span class="kt">float</span> <span class="n">yDistance</span><span class="p">)</span> <span class="p">=</span> <span class="n">CalculateAabbDistanceTo</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
<span class="p">(</span><span class="kt">float</span> <span class="n">xVelocity</span><span class="p">,</span> <span class="kt">float</span> <span class="n">yVelocity</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">VelocityX</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">VelocityY</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">xAxisTimeToCollide</span> <span class="p">=</span> <span class="n">xVelocity</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">?</span> <span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">xDistance</span> <span class="p">/</span> <span class="n">xVelocity</span><span class="p">)</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">yAxisTimeToCollide</span> <span class="p">=</span> <span class="n">yVelocity</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">?</span> <span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">yDistance</span> <span class="p">/</span> <span class="n">yVelocity</span><span class="p">)</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
</code></pre></div>

<p>Resolving collision based on collision time solves some corner-cases where an object is very close to collision on one axis, but moving much faster on the other axis (eg. a player falling off a tall building moves into it, and instead of colliding against the side, he collides with the top).</p>
<p>Once we know which collision is first, it's easy to resolve if the collision is only on one axis:</p>
<div class="highlight"><pre><span></span><code><span class="kt">float</span> <span class="n">shortestTime</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">xVelocity</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">yVelocity</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Colliison on X-axis only</span>
    <span class="n">shortestTime</span> <span class="p">=</span> <span class="n">xAxisTimeToCollide</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span> <span class="p">=</span> <span class="n">shortestTime</span> <span class="p">*</span> <span class="n">xVelocity</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">xVelocity</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">yVelocity</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Collision on Y-axis only</span>
    <span class="n">shortestTime</span> <span class="p">=</span> <span class="n">yAxisTimeToCollide</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span> <span class="p">=</span> <span class="n">shortestTime</span> <span class="p">*</span> <span class="n">yVelocity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Finally, the most complex case: what do we do if the object would collide on both X- and Y-axes? We resolve the fastest collision first:</p>
<div class="highlight"><pre><span></span><code><span class="k">else</span>
<span class="p">{</span>
    <span class="c1">// Collision on X and Y axis (eg. slide up against a wall)</span>
    <span class="n">shortestTime</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">xAxisTimeToCollide</span><span class="p">),</span> <span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">yAxisTimeToCollide</span><span class="p">));</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span> <span class="p">=</span> <span class="n">shortestTime</span> <span class="p">*</span> <span class="n">xVelocity</span><span class="p">;</span>
    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span> <span class="p">=</span> <span class="n">shortestTime</span> <span class="p">*</span> <span class="n">yVelocity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Easy! If it would take 0.1s to collide on the X-axis, and 0.2 on the Y-axis, we increment the entity's X and Y by their velocity times 0.1 (the faster collision time).</p>
<p>Finally, for stable resolutions, make sure you run the collision resolution twice per update. Since MonoGame-based frameworks give you the update time, simply run the update twice, with half of the elapsed time, each update:</p>
<div class="highlight"><pre><span></span><code><span class="kt">var</span> <span class="n">halfElapsed</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span><span class="p">(</span><span class="n">elapsed</span><span class="p">.</span><span class="n">TotalMilliseconds</span> <span class="p">/</span> <span class="m">2</span><span class="p">);</span>
<span class="c1">// Resolve collisions twice to stabilize multi-collisions.</span>
<span class="k">this</span><span class="p">.</span><span class="n">ProcessMovement</span><span class="p">(</span><span class="n">halfElapsed</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="n">ProcessMovement</span><span class="p">(</span><span class="n">halfElapsed</span><span class="p">,</span> <span class="n">entity</span><span class="p">);</span>
</code></pre></div>

<p>That's it, you're done!</p>
<h2>Slide on Collide</h2>
<p>With basic collision resolution out of the way, you might ask "how do I slide up against the target object instead of simply stopping abruptly?"</p>
<p>The answer to that caused about 50% of my development time. The answer is "you collide as usual but then move on the other axis as much as is reasonable," where reasonable means "don't move so much you collide with something else." In this case, don't slide if doing so would land you in another AABB collision.</p>
<p>Another complication I can't explain well is my need to refer to the "old" intended X/Y distances; I'm not 100% sure at this moment why I needed those, but those are needed for a proper resolution.</p>
<p>Some code:</p>
<div class="highlight"><pre><span></span><code>    <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">SlideOnCollide</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Setting oldIntendedX/oldIntendedY might put us directly inside another solid thing.</span>
        <span class="c1">// No worries, we resolve collisions twice, so the second iteration will catch it.</span>

        <span class="c1">// Resolved collision on the X-axis first</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shortestTime</span> <span class="p">==</span> <span class="n">xAxisTimeToCollide</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Slide vertically</span>
            <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="c1">// If we&#39;re in a corner, don&#39;t resolve incorrectly; move only if we&#39;re clear on the Y-axis.</span>
            <span class="c1">// Fixes a bug where you  move a lot in the corner (left/right/left/right) and suddenly go through the wall. </span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">isAabbCollision</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Y</span> <span class="p">+</span> <span class="n">oldIntendedY</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span>
                <span class="n">collideAgainst</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">collideAgainst</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">Height</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span> <span class="p">=</span> <span class="n">oldIntendedY</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// Resolved collision on the Y-axis first</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shortestTime</span> <span class="p">==</span> <span class="n">yAxisTimeToCollide</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Slide horizontally</span>
            <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaY</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="c1">// If we&#39;re in a corner, don&#39;t resolve incorrectly; move only if we&#39;re clear on the X-axis.</span>
            <span class="c1">// Fixes a bug where you  move a lot in the corner (left/right/left/right) and suddenly go through the wall.</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">isAabbCollision</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> <span class="n">oldIntendedX</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Height</span><span class="p">,</span>
                <span class="n">collideAgainst</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">collideAgainst</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">Height</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">entity</span><span class="p">.</span><span class="n">IntendedMoveDeltaX</span> <span class="p">=</span> <span class="n">oldIntendedX</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2>Wrapping it All Up</h2>
<p>That concludes a somewhat whirlwind tour of AABB collision detection. I hope you came out of it understanding the pros and cons, how to assess when you need it or not, and enough pseudo-code to actually get it working for you.</p>
<p>I would love to hear from you! If you have any feedback, please drop me a message/tweet <a href="https://twitter.com/nightblade99">on Twitter</a>.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/integrating-religion-into-games.html" rel="bookmark" title="Permalink to Integrating Religion Into Games">
                                       Integrating Religion Into Games
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2019-10-30




    
</footer><!-- /.post-info -->                                <p>Tags: Methodology</p>
<p><img src="https://i.imgur.com/qr8ljtY.jpg" alt="screenshot of a verse of Qur'an in Eman Quest" width="750" height="474" /></p>
<p>I recently engaged in a conversation with someone about religion and games; specifically, about me showing, explaining, and playing the audio of verses of the Qur'an in my games. This discussion lead me to think about, question, evaluate, and eventually understand (at a deeper level) why I do this, and why I included that section in that game.</p>
<p>To summarize: I think the use of religion (specifically, elements of Islam and Muslim culture) in games is essential for many reasons, including breaking stereotypes and building a deeper understanding of what Islam's canonical texts really mean. In fact, the word "deen" in "Deen Games" means religion, but it also means "a way of life."</p>
<h2>Why Integrate Religion Into Games?</h2>
<p>So, the core issue: why bother mixing religion with games? Certainly, this is not something people ask for (barring a very narrow definition of "game" and focusing on educational aspects, usually in the form of quizzes).</p>
<p>Some thoughts that come to mind:
- Religion, in general, is something that is often looked down upon as "backward," "violent," and not useful.
- Religion in games, is seen as almost a taboo; something people just don't do.
- In the past, some people have made thinly-veiled religious propaganda as games</p>
<p>In particular, if you look at the demographic of Muslims, it paints a similarly bleak picture:
- Muslims are often portrayed as terrorists, oppressors, and backward in media
- Games are no better - Muslims commonly appear as the antagonists in first-person shooters, supplanting Nazis</p>
<p>Knowing all this, a not-so-obvious solution becomes obvious: why not use games to counter the negativity and stereotypes around religion and Islam in particular? Games reach around the world, but can uniquely engage players interactively; can create fantsatic scenarios that don't exist outside; and can cast players in the role of those they wouldn't normally choose to be. Games can show an alternative view, and potentially build empathy for marginalized groups. (In fact, some ideologies already use games to achieve all these goals.)</p>
<p>That brings us back to Deen Games. Our mission is not to create religious propaganda or poorly-disguised quizzes. We actively work to create fun, innovative, unique, accessible games that include Muslim culture, history, and beliefs as an integral part of the game universe.</p>
<p>As one person <a href="https://twitter.com/bcscarbrough/status/1188791237089857537">aptly tweeted</a>: </p>
<blockquote>
<p>If your beliefs do not bleed into your creative process on some level, they are not your beliefs. I expect a game made by Muslims to have some aspects of their beliefs even if they're not overt. Scrubbing games of every hint of a belief system to avoid offense is imo offensive.</p>
</blockquote>
<h2>What we can Learn from Islamic Games</h2>
<p><img alt="data cube in Ali the Android which references a verse of Qur'an" src="https://i.imgur.com/v15ki7y.png"></p>
<p>My specific interest within Islamic games is to create games that leave the player with an understanding and practical application of canonical texts of Islam through games. Because games allow us to create arbitrary fantastical scenarios and situations (fantasy and sci-fi in particular), this provides us a rich, fertile ground for creative expression and building a real understanding.</p>
<p>Creating Islamic games with visibly Muslim characters not only breaks stereotypes, but it also normalizes us in popular culture, contrary to how we're often portrayed in media.</p>
<p>It also confers an additional benefit: it allows us to easily break the common tropes/stereotypes of games. For example, a fantasy game <a href="https://deengames.itch.io/eman-quest">like Eman Quest</a> might contain slimes, bats, sentient rocks; but also jinns and other creatures/elements drawn from our Islamic theology and history.</p>
<h2>It's a Trade-Off Though</h2>
<p>Like choosing a pixel-art or low-poly aesthetic to your game, choosing to include Islamic elements comes with some down-sides. I expect the benefits to (greatly) overwhelm the downsides, which include:</p>
<ul>
<li>This can break immersion. In particular, the Islamic content must be well-integrated into world lore.</li>
<li>It doesn't appeal to everyone. A rather vocal group exists decrying religion in games. Even Nintendo <a href="http://www.escapistmagazine.com/articles/view/features/15045-Nintendo-of-America-Used-Religious-Censorship-to-Avoid-Controver">has a history</a> of <a href="https://kotaku.com/losing-our-religion-5509744">removing religious elements</a> from <a href="https://en.wikipedia.org/wiki/ActRaiser#Religious_subtext">various games</a>.</li>
<li>It takes practice to integrate religious identity and iconography and beliefs in games - especially if you don't want a very superficial integration.</li>
<li>Not every religious quote, source, message, symbol, etc. can or should be integrated into games.</li>
</ul>
<h2>Closing Thoughts</h2>
<p>Thanks for taking the time to read this! I highly encourage you to <a href="https://twitter.com/nightblade99">drop me some comments on Twitter</a> and let me know your thoughts.</p>
<p>Or, if you feel up to it, why not include a visibly Islamic element/character/outfit in your next game? I would be happy to work with you on this to define something you feel happy about including in your games.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 5
        <a href="https://www.deengames.com/blog/author/nightblade2.html">&raquo;</a>
        <a href="https://www.deengames.com/blog/author/nightblade5.html">&#8649;</a>
</p>
                </section><!-- /#content -->
</div>
                </div>
            </div>
            <!-- start sidebar -->
            <div class="span3">
                <section id="sidebar">
                    <div>
                        <h2>Browse content by</h2>
                        <ul class="fa-ul">
                        <li><a href="https://www.deengames.com/blog/categories.html"><i class="fa-li fa fa-tags"></i> Categories</a></li>
                        <li><a href="https://www.deengames.com/blog/archives.html"><i class="fa-li fa fa-calendar"></i> Dates</a></li>
                        <li><a href="https://www.deengames.com/blog/tags.html"><i class="fa-li fa fa-tag"></i> Tags</a></li>
            
                        <li><a href="/feeds/atom.xml"><i class="fa-li fa fa-rss"></i> Feed</a></li>
                        </ul>
                    </div><!-- /.browse -->
                    <div>
                        <h2>Links</h2>
                        <ul>
                            <li><a href="https://www.deengames.com">All Games</a></li>
                            <li><a href="https://www.getrevue.co/profile/deengames">Newsletter</a></li>
                            <li><a href="https://discord.gg/5D6XS3b">Discord Community</a></li>
                        </ul>
                    </div><!-- /.Links -->
                    <div>
                        <h2>Social</h2>
                        <ul>
                            <li><a href="https://twitter.com/nightblade99">Twitter</a></li>
                        </ul>
                    </div><!-- /.social -->
<!-- /.Tags -->
                </section><!-- /#sidebar -->
            </div>
            <!-- end sidebar -->
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            Copyright &copy; NightBlade, 2018+. All rights reserved.
        </div>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11092514-7']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>