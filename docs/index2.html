<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="nightblade" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="Deen Games Blog"/>
    <meta property="og:url" content="https://www.deengames.com/blog"/>
    <meta property="og:site_name" content="Deen Games Blog"/>
    <meta property="og:type" content="website"/>

    <link rel="canonical" href="https://www.deengames.com/blog" />

    <title>Deen Games Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="https://www.deengames.com/blog/theme/css/main.css" />
    <link href="/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Deen Games Blog Atom Feed" />
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span9">
            <header id="banner" >
                <h1>
                    <a href="https://www.deengames.com/blog/">Deen Games Blog </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li><a href="https://www.deengames.com/blog/pages/about.html">About</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/devlog.html">Devlog</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/news.html">News</a></li>
                            <li ><a href="https://www.deengames.com/blog/category/other.html">Other</a></li>
                        </ul>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>

        <div class="row-fluid">
            <div class="span9">
                <div class="row-fluid">
<div class="span9">
                <section>
                    <ol id="posts-list" class="hfeed" start="4">
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/eman-quest-retrospective.html" rel="bookmark" title="Permalink to Eman Quest Retrospective">
                                       Eman Quest Retrospective
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/devlog.html">Devlog</a>

    on 2019-08-22

        |
        tags:         <a href="https://www.deengames.com/blog/tag/godot.html">Godot</a>



    
</footer><!-- /.post-info -->                                <p><img src="https://i.imgur.com/rpSFnxr.png" alt="screenshot of the protagonist in a cave map" width="750" height="450" /></p>
<p>Welcome to the rather large retrospective on <a href="https://deengames.itch.io/eman-quest">Eman Quest</a>. Eman Quest, if you haven't heard about it, is a "procedurally-generated mini-RPG with memory mechanics." You can try the full game, for free, on Itch.</p>
<p>This retrospective covers two parts: first, the overall idea (what did I plan to achieve? What did I actually achieve? Reflections), and the key lessons learned (mostly specific to Godot).</p>
<h1>The Overall Idea: A Procedurally-Generated RPG</h1>
<p>I really like procedural content generation (in general), although it's deceptively difficult to implement correctly (corner cases really get you). I always wanted to make a "procedurally-generated Chrono Trigger-like RPG," although that's a huge undertaking; Eman Quest was the first step: creating a small, "lightweight" or "mini" RPG.</p>
<p>What, exactly, did I include in Eman Quest?</p>
<ul>
<li>A fixed story about life, faith, and family</li>
<li>Seven different areas; these are three geographies (forest, cave, and dungeon) each with multiple biomes (frost forest, death forest, desert dungeon, etc.)</li>
<li>A unique world: each time you play a new game, it picks three out of seven biomes, and generates the required maps for each.</li>
<li>Unique enemies, two per area, statically-generated and balanced with careful trade-offs (eg. glass cannon, tank), and a unique boss per biome.</li>
<li>Procedurally-generated equipment (weapons, armour), including their stats</li>
<li>A battle system that relies on not puzzle/thinking or skills/reflexes, but memory: remember the selected tiles, pick them to get action points, chain them to get tech points, and then use them for your turn.</li>
<li>Two fixed skills in battle</li>
<li>A progression system with experience, levels, and stats points you can distribute to your liking (respeccing is free).</li>
</ul>
<p><img src="https://i.imgur.com/2bx1y6M.gif" alt="one round of battle" width="750" height="450" /></p>
<p>I didn't include many things in Eman Quest; specifically, I analyzed Bastion, how they cut corners to cut down on the amount of content they needed to complete the game, and applied it to my game. Specificially:</p>
<ul>
<li>I scrapped procedural story-, world-, event-, and character-creation, and wrote a fixed story instead</li>
<li>I scrapped the world map, because it adds little or no value</li>
<li>I didn't incude any NPCs or shops, because those require a lot of art/coding. (You always find better equipment in chests than what you're using.)</li>
<li>I cut a few things in content: avatars, some biome variants (crystal caves), variant bosses, and unique final-boss skills.</li>
</ul>
<h1>What Went Well</h1>
<p>Overall, I am very happy with the result, and thankful that I could finish this project, although it doesn't come quite close to my initial vision (due to scope cuts and resource/time constraints).</p>
<p>Things I really like about Eman Quest:</p>
<ul>
<li>It "feels" like a procedurally-generated RPG.</li>
<li>It's balanced (monsters seem quite distinct/different to fight) even though it's on the easy side</li>
<li>Quite a few people completed the game</li>
<li>The memory mechanics received some compliments (more on the design below)</li>
<li>I shipped. Especially considering I tend to abandon long-running projects, this is especially important to me</li>
<li>I polished the game considerably, including audio (background and sound-effects)</li>
<li>I received some fan-art, and several questions about my protagonist; which prompted me to create an elaborate background, and a character representing many minorities: a strong woman, a Muslim, and an African</li>
<li>I represented Muslims and Islam positively, and communicated one of our values (good treatment of parents)</li>
<li>I learned a lot about game accessibility, and added a few accessibility options into my game</li>
</ul>
<p>Below, you can see the fan-art of the protagonist, Aisha.</p>
<p>As my first full Godot project, I'm not really proud of the code quality; as I joked on <a href="https://discord.gg/frKXYtG">my Discord server</a>, code quality decreases as you get closer to production!</p>
<p><img src="https://i.imgur.com/LeKMWbk.jpg" width="600" height="570" /></p>
<h2>Memory Mechanics</h2>
<p><img alt="memory mechanics screenshot" src="https://i.imgur.com/xOOetlV.png"></p>
<p>Aside from the technical challenge of creating a procedural RPG, I challenged myself to create a fun battle mechanic based on memory instead of reflexes or puzzles.  I also received lots of good feedback about this from users, who praised the memory mechanic as interesting.</p>
<p>The core mechanic works simply: a 5x5 grid appears, some squares highlight for a fractional second, and then disappear. You need to click on those highlighted tiles to accumulate "action points," which you can use for different actions (attack costs 2, critical costs 3, and defend/heal costs 1).</p>
<p>In initial prototypes, I experimented with requiring players to pick both energy (action poinst) and actions they wanted to play. This proved to be quite "stressful," because you have a fractional second to look for both required energy tiles and action tiles; midway through development, I streamlined it into what it is now.  I also tried several variations (incluiding a "simon says" type mini-game and a stream of "which of these items did you never see before"), both of which didn't seem fun enough to include in the final.</p>
<p>I also found that battles become somewhat rote and mechanical/deterministic after a while: you pick the five specified tiles, then pick crit, attack, and repeat, healing as necessary.  To change it up, and to reward skillful play, I added techniques/skills and technical points.</p>
<p>Players who pick three or more tiles correctly in a row (with no mistakes) acquire tech points. If you select all five tiles correctly, you get a total of three tech points. You can save these up and use either five or seven for stun/vampire skills respectively. This adds an element of strategy and non-determinism.  Tech poinst also persist across battles, adding another dimension of planning.</p>
<h1>What Didn't Go Well + Key Insights</h1>
<p>I initially planned one month to complete the project; it ended up taking around nine months. Why? Many reasons, including:</p>
<ul>
<li>I realized early on that different forests just didn't cut it, and needed both variation (styles of forests) and map types (cave, dungeon, etc.)</li>
<li>Creating art was not my strong-suite, and I needed three distinct tilesets, each with two unique variations</li>
<li>Finding, drawing and animating 14 monsters, and their walk cycles, took a lot of effort; even though I found many of the base sprites and received lots of help on the art side.</li>
<li>I added the story about five months in, and required implementing an entire message dialog system, key-item system, final-game events, and lots of unexpected things.</li>
<li>Technical struggles with, and crashes in, Godot (more on that below).</li>
</ul>
<p>I ran into several difficulties along the way.  These include:</p>
<ul>
<li>Learning Godot's API, which seemed quite foreign to me (anything is a scene and can contain sub-scenes). Also, Godot is quite a wide framework, and it takes time to discover/learn/use things (like UI components).</li>
<li>Learning about Godot's automatic garbage-collection (<code>free</code> and <code>queue_free</code>) and how they destroy all objects when changing scenes. This caused me to rewrite my early version to completely separate data about maps (tiles, treasure, etc.) from the visual presentation of those, which got GCed.</li>
<li>I wrote garbage, prototype-quality code throughout. This lead to numerous bugs (some difficult to diagnose and fix), and a cycle of "fix something but break something else" late in development. You can see tweets with some bugs, including a few hilarious ones, <a href="https://twitter.com/search?q=%40nightblade99 %23EmanQuest %23Bugs">here</a>.</li>
<li>I didn't write any unit or integration tests. This meant I could break things without noticing for days/weeks. I remedied this quite late in development by using GUT (Godot Unit Testing).</li>
<li>Lack of CI. Unlike other, C#-based projects, I couldn't get Travis to run my tests; so if I forgot to run tests, broken things stay unnoticed.</li>
<li>The final game crashed a lot, which caused a lot of stress and resulted in a lot of lessons; so I wrote a section just on that.</li>
<li>Close to the end of development, I lost my GPU on my main development machine, and my main Windows installed contained drivers that didn't run with Godot 3.0.6. I ended up switching to Linux (which included up-to-date drivers), but lost of a lot of time; I also upgraded Godot to 3.1.1, which initially showed a problem with cave maps running at 2-3FPS, but works fine on Linux.</li>
<li>Serialization for saving games. As <a href="https://docs.godotengine.org/en/3.1/tutorials/io/saving_games.html">the Godot docs on saving games</a> suggests, you need to <em>manually</em> serialize all your (nested, hierarchial) data structures into JSON. This requires a lot of boilerplate, and it's very tedious (you may miss a field and not realize unless you test thoroughly).</li>
</ul>
<h2>The Game Crashed on Release</h2>
<p>When I released the game, it crashed. A lot. This undoubtedly resulted in a terrible first-impression, although I received several supportive comments such as "it crashed once and then I reloaded and it was fine" or "it keeps crashing after battles but I completed the game."</p>
<p>Why did it crash, why didn't I notice, and how did I fix the crashes?  Well, I'm glad you asked.</p>
<p>Godot runs the game in the editor, somewhat differently from when you export the final platform-specific release. This includes differences such as caring about case-sensitivity (which the Editor doesn't, on Windows), and - critically - crashing when you do Bad Things (like waiting for an event and disposing the scene before it comes back).</p>
<p>I always tested Eman Quest from within the editor, so I never noticed (or cared to notice?) the errors. The game also crashed on Linux and (troublingly) MacOS (which I don't have hardware to test with), but not on Windows, so I failed to catch it in my pre-release testing.</p>
<p>In the end, I upgraded Godot from 3.0.6 to 3.1.1 (someone commented that it didn't work with their graphics card, and 3.1.1 works with OpenGLES 3.1 and earlier), and the crashes disappeared.  I also:</p>
<ul>
<li>Tested on Linux (after switching to Linux) and found I could reproduce, and fix, one crash</li>
<li>Fixed sporadically-appearing errors that Godot printed out, which fixed at least one crash</li>
<li>Received great offers of help from people on Twitter, specifically running MacOS, who found workflows in-game that reproduced the crash, and verified after I fixed them.</li>
</ul>
<h1>Action Items</h1>
<p>I learned several key lessons out of this. Learning about Godot itself proved invaluable; beyond that:</p>
<ul>
<li><strong>Write clean code.</strong> (Clean meaning, as good as you can make it.) This results in less bugs and less painful troubleshooting later on when things turn bad.</li>
<li><strong>Export and test your project often.</strong> This catches bugs, crashes, and all kinds of badness that you don't want players to find first.</li>
<li><strong>Fix all runtime errors, and any errors/warnings Godot generates.</strong> These often foreshadow crashes when the game runs (sometimes, only on select platforms - Windows seems fairly resilient)</li>
<li><strong>Unit test everything.</strong> Unit testing is cheap, runs quickly, and pays for itself in spades; you can quickly catch issues without manually retesting everything.</li>
<li><strong>Set up a continuous integration pipeline to run your tests.</strong> With GitHub and Travis, you can check in code, and get an email whenever you broke some tests (but didn't notice by running them manually). That can be invaluable to avoid breaking things that work.</li>
<li><strong>The Godot community is awesome.</strong> Ask on Discord, open a GitHub issue, post a tweet - there are experienced developers who will get back to you, promptly, with solid solutions. Just be careful what you ask for! (I upgraded to Godot 3.1.1  and needed to redo all my UI to fix a tiny bug with one slider.)</li>
<li><strong>Always update to the latest version of Godot.</strong> It really works better, and often clears up hard-to-fix bugs.</li>
<li><strong>Make friends on Twitter.</strong> You never know who will like, follow, comment, download your game, and - critically - help often comes from those who we least expect it from.</li>
</ul>
<p>Finally, I want to personally thank everyone who helped me with the project - you know who you are. Without your help, coaching, support, and mentorship, I would never actually finished the game.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/capture-in-game-screenshots-in-godot.html" rel="bookmark" title="Permalink to Capture In-Game Screenshots in Godot">
                                       Capture In-Game Screenshots in Godot
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2019-06-11




    
</footer><!-- /.post-info -->                                <p>Tags: Godot</p>
<p><img alt="Animation of a game saving, with a screenshot appearing on the save screen" src="https://i.imgur.com/OlsyPli.gif"></p>
<p>Godot allows you to capture in-game screen-shots, without the use of any plugins/addons. However, I couldn't find a complete, step-by-step guide to do this, without relying on any specific nodes being instantiated in your scene.</p>
<p>You can follow these steps. I tested these on Godot 3.0.6. Some of the code originated in a thread that mentioned that "you need this prior to Godot 3.1," but through testing, I eventually removed all unnecessary code. I can confirm that this sample works, because I implemented it in <a href="https://twitter.com/search?q=%23EmanQuest">Eman Quest</a>.</p>
<h1>Saving Screenshots</h1>
<p>Godot provides a rather straight-forward API for saving a screenshot:</p>
<div class="highlight"><pre><span></span><code><span class="n">var</span> <span class="n">screenshot_path</span> <span class="o">=</span> <span class="ss">&quot;user://screenshot-test.png&quot;</span>

<span class="o">#</span> <span class="n">Retrieve</span> <span class="n">the</span> <span class="n">captured</span> <span class="n">image</span>
<span class="n">var</span> <span class="n">image</span> <span class="o">=</span> <span class="n">get_tree</span><span class="p">().</span><span class="n">get_root</span><span class="p">().</span><span class="n">get_texture</span><span class="p">().</span><span class="n">get_data</span><span class="p">()</span>

<span class="o">#</span> <span class="n">Flip</span> <span class="n">it</span> <span class="k">on</span> <span class="n">the</span> <span class="n">y</span><span class="o">-</span><span class="n">axis</span> <span class="p">(</span><span class="n">because</span> <span class="n">it</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">flipped</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">flip_y</span><span class="p">()</span>

<span class="n">image</span><span class="p">.</span><span class="n">save_png</span><span class="p">(</span><span class="n">screenshot_path</span><span class="p">)</span>
</code></pre></div>

<p>This saves a screenshot into a file called <code>screenshot-test.png</code>, under the user space; on Windows, that's something like <code>C:\Users\CURRENTLY_LOGGED_IN_USER\AppData\Roaming\Godot\app_userdata\Eman Quest\screenshot-save0.png</code>, where <code>CURRENTLY_LOGGED_IN_USER</code> is your user name (eg. <code>nightblade</code>).</p>
<h1>Loading Screenshots</h1>
<p>Loading screenshots proves more complicated:</p>
<ul>
<li>To load the data, you can use <code>image.load_png_from_buffer</code>, but it takes a <code>PoolByteArray</code> - not something you can load with a call to <code>preload("res://...")</code>. This requires using the <code>File</code> API.</li>
<li>To set the texture onto a sprite, you cannot simply assign it to an <code>Image</code> instance; instead, you need to create and initialize an <code>ImageTexture</code> instance.</li>
</ul>
<p>After we sort through these issues, we end up with code like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">var</span> <span class="n">file</span> <span class="o">=</span> <span class="n">File</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="n">file</span><span class="p">.</span><span class="k">open</span><span class="p">(</span><span class="ss">&quot;user://screenshot-test.png&quot;</span><span class="p">,</span> <span class="n">File</span><span class="p">.</span><span class="k">READ</span><span class="p">)</span>
<span class="n">var</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="n">get_buffer</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">get_len</span><span class="p">())</span>
<span class="n">file</span><span class="p">.</span><span class="k">close</span><span class="p">()</span>

<span class="n">var</span> <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="n">image</span><span class="p">.</span><span class="n">load_png_from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>

<span class="n">var</span> <span class="n">image_texture</span> <span class="o">=</span> <span class="n">ImageTexture</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="n">image_texture</span><span class="p">.</span><span class="n">create_from_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="n">sprite</span><span class="p">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">image_texture</span>
</code></pre></div>

<p>This loads the PNG file <code>screenshot-test.png</code> from the user-space into an <code>Image</code>, wraps it into an <code>ImageTexture</code>, and assigns it to some <code>Sprite</code> instance</p>
<h1>Crop and Scale</h1>
<p>Since we loaded our PNG into a <code>Sprite</code>, we can execute other operations on it:</p>
<ul>
<li>You can set the <code>region_rect</code> properties (through code or through the editor) to crop the image</li>
<li>You can set the <code>scale</code> to create a thumbnail of the image</li>
<li>You can apply effects, colourization, etc.</li>
</ul>
<p>This affords a lot of interesting use-cases, such as creating a thumbnail of the in-game screen per save-game (my personal use case).</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/getting-started-with-unit-and-integration-testing-in-godot.html" rel="bookmark" title="Permalink to Getting Started with Unit and Integration Testing in Godot">
                                       Getting Started with Unit and Integration Testing in Godot
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2019-05-13




    
</footer><!-- /.post-info -->                                <p>Tags: Godot, Testing</p>
<p><img alt="screenshot with code on top" src="https://i.imgur.com/F3hoasj.jpg">
(Image credit: <a href="https://godotengine.org/article/tests-needed-godot-2-1-4-beta">Godot blog</a>)</p>
<p>Godot affords the possibility of unit and integration testing <code>gdscript</code> code via the GUT extension. If you're getting started with unit/integrated testing (collectively "automated testing") or Godot, and interested in what automated testing can do for you, read on.</p>
<h1>What is Automated Testing and Why do I Care?</h1>
<p>Your game contains lots of logic. When you make changes, you need to re-test that everything that worked before, still works (nothing broke). As you find and fix bugs, and get into corner-cases of your game (eg. testing the entire play-through), manually re-testing everything becomes more and more time-consuming.</p>
<p>Automated testing provides a solution to these problems: what if you could <em>write code</em> that would test your game code? What if that code could run through all the necessary scenarios of your game in a matter of minutes, or seconds? What if you could run the tests after every single change, and be sure that you never broke anything?</p>
<p>Automated testing provides exactly this benefit. You write test-code that tests your "production" code. Unit tests, which test very small levels of functionality, run in in a matter of milliseconds; integration tests, which typically test workflows (fight monster, get experience, level up, spend skill points) take longer, but allow you to automate workflows.</p>
<p>Finally, any experienced developer with automated testing will agree: the <em>mindset change</em> you get from automated testing is unparalleled. Not only can you test <em>every single line of code</em> you change, making sure it works, but you can also make bigger, riskier changes, because of your safety-net of unit tests. You can actually go faster, and make bigger changes, with your safety net of automated tests.</p>
<h1>The Downside of Automated Testing</h1>
<p>Like many things, automated testing is a trade-off. Unit testing is the de-facto standard now in the software industry, so we happily accept the downsides in exchange for the wealth of benefits we receive. Regardless, here they are:</p>
<ul>
<li><strong>Automated tests take time to write.</strong> You could be writing production code instead! For very tiny projects, proof-of-concepts, prototypes, and simple applications, you may not care about testing at all.</li>
<li><strong>Writing testable code changes your code.</strong> Your code ends up being more decoupled, more isolated, and more testable. While these are all good software engineering practices, some communities look down on this.</li>
<li><strong>Flaky tests.</strong> Poorly-written integration tests (and sometimes unit tests) can fail on and off, sometimes for reasons not related to your change. (As you become more experienced with testing, you learn how to write less-flaky tests.)</li>
<li><strong>Major refactoring is expensive.</strong> If you decide to change a significant amount of code - like moving a method from one place to another, or significantly changing functionality - you now need to pay the cost of updating lots of broken tests.</li>
</ul>
<p>Overall, the benefits heavily outweigh the costs. There's really no reason not to write automated tests!</p>
<h1>Unit vs. Integration Testing</h1>
<p>We touched earlier on the difference between unit and integration tests. Typically, unit tests test a single method or class. The hallmark of unit tests, is that they don't depend on anything external - they don't touch the database, the file-system, they don't make web-service calls, etc. Because of this, unit tests tend to be extremely stable and robust, and run in sub-millisecond time. A large suite of thousands of unit tests may run in just a few seconds.</p>
<p>However, unit tests, by nature, test only a very limited set of functionality. Integration tests, in contrast, typically test more complex scenarios, and/or workflows.</p>
<p>Imagine we wrote an RPG-style game. The user can battle monsters; on victory, he receives experience points, and can use those to invest in learning new skills.  If we structured this as typical domain-driven classes (such as <code>Player</code>, <code>Monster</code>, etc.) we might write unit tests such as:</p>
<ul>
<li><code>Player.attack(target)</code> damages the target</li>
<li><code>Player.hurt(damage)</code> decreases health</li>
<li><code>Player.hurt(damage)</code> throws an error if damage is less than zero (programmer bug)</li>
</ul>
<p>These are all class/object/method-level tests. In contrast, we might write integration tests such as:</p>
<ul>
<li>When a player fights an enemy and defeats it, the player receives experience points</li>
<li>When the player receives enough XP, they level up and gain skill points</li>
<li>When monsters defeat the player, the game reaches a "game over" state</li>
</ul>
<p>These tests, by nature, work with a larger set of code - so you can test more things. But, they can also be more fragile - if something breaks in the workflow (damage calculation broken? Level-up calculation broken? Skill-points UI broken?), the test can fail.</p>
<h1>Godot with  Mono vs. GDscript</h1>
<p>Godot provides two options for unit testing, depending on whether you prefer C# or GDscript.</p>
<p>If you prefer C#, create your project as a Godot + Mono project, and write as much logic as possible in the C# code. This way, you can use the "usual" set of C# testing tools (NUnit, Moq, etc.) and everything Just Works.</p>
<p>If you can't, won't, or prefer GDscript, you can use the GUT extension. (GUT stands for Godot Unit Test.)</p>
<h1>Getting Started Testing (with Gut)</h1>
<p>The <a href="https://github.com/bitwes/Gut">GUT project page on GitHub</a> provides a <a href="https://github.com/bitwes/Gut/wiki/Install">detailed explanation of getting started</a>, which I won't repeat here. Install GUT in your project, create a new scene with the <code>Gut</code> object, and you're ready to go.</p>
<p>Instead, I'll focus on getting started testing: what do you test? Assuming you have an existing project with an extensive code-base and zero unit tests, what do you do?</p>
<p>Fundamentally, you need to start doing two things:</p>
<p>1) Refactor your code to make it more testable
2) Write tests for any new code</p>
<p>We didn't really touch on testable code in any depth. The short version is: write simple classes with simple methods, and avoid dependencies on any external "things." For example, if your <code>Player.damage</code> class depends on a <code>Globals.battle_difficulty</code> multiplier, accept it as a passed-in value instead of referencing the <code>Globals</code> script. Change this:</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span> <span class="n">player</span><span class="p">.</span><span class="n">gd</span>
<span class="k">class</span> <span class="n">damage</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
  <span class="n">var</span> <span class="n">total_defense</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="n">defense</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Globals</span><span class="p">.</span><span class="n">battle_difficulty</span><span class="p">)</span>
  <span class="n">target</span><span class="p">.</span><span class="n">current_health</span> <span class="o">-=</span> <span class="k">self</span><span class="p">.</span><span class="n">strength</span> <span class="o">-</span> <span class="n">total_defense</span>

<span class="o">//</span> <span class="n">Elsewhere</span>
<span class="n">player</span><span class="p">.</span><span class="n">damage</span><span class="p">(</span><span class="n">selected_monster</span><span class="p">)</span>
</code></pre></div>

<p>To this:</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span> <span class="n">player</span><span class="p">.</span><span class="n">gd</span>
<span class="k">class</span> <span class="n">damage</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">battle_difficulty</span><span class="p">):</span>
  <span class="n">var</span> <span class="n">total_defense</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="n">defense</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">battle_difficulty</span><span class="p">)</span>
  <span class="n">target</span><span class="p">.</span><span class="n">current_health</span> <span class="o">-=</span> <span class="k">self</span><span class="p">.</span><span class="n">strength</span> <span class="o">-</span> <span class="n">total_defense</span>

<span class="o">//</span> <span class="n">Elsewhere</span>
<span class="n">player</span><span class="p">.</span><span class="n">damage</span><span class="p">(</span><span class="n">selected_monster</span><span class="p">,</span> <span class="n">Globals</span><span class="p">.</span><span class="n">battle_difficulty</span><span class="p">)</span>
</code></pre></div>

<p>While the code is functionally equivalent, the latter is far more testable: you can pass in whatever value of <code>battle_difficutly</code> you want in your tests, even invalid values like -3! In fact, this is the kind of functionality you want to unit-test: in addition to making sure it works with a correct difficulty, you can test that it fails appropriately (eg. throws an error or returns 0) with an invalid value - something you can't easily test through the actual game.</p>
<h1>In Conclusion</h1>
<p>We covered a lot of ground in this article.  In summary:</p>
<ul>
<li>We talked about automated testing, and why we care about it at all</li>
<li>We looked at some of the benefits and advantages of unit-testing</li>
<li>We touched on some of the downsides, most of which are not really disadvantageous</li>
<li>We looked at unit vs. integration tests, and one way to define integration tests as workflows</li>
<li>We covered testing with C# (in brief) vs. testing GDscript with Godot</li>
<li>We looked at writing a few simple unit tests on a player class, and making code more testable</li>
</ul>
<p>I hope this post benefited you, and convinced you to at least try unit testing! Please let me know your feedback <a href="https://twitter.com/nightblade99">on Twitter</a> - whether you decide to try testing, what you didn't understand, and what kind of topics you would like me to cover in future articles on Godot and testing.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/godot-game-crashes-on-startup-logo-showshides.html" rel="bookmark" title="Permalink to Godot Game Crashes On Startup, Logo Shows/Hides">
                                       Godot Game Crashes On Startup, Logo Shows/Hides
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2019-04-29




    
</footer><!-- /.post-info -->                                <p>Tags: Godot, Android</p>
<p>I recently rebuilt a small app/game using Godot. For reference, the game contained one core loop, and took about four hours to build (from scratch). I reused all of the assets from the previous version of the game (audio and graphics), which took the bulk of development time on the original.</p>
<p>The game built and ran flawlessly in Godot on Windows. As soon as I ran it on Android, the game briefly showed the Godot loading logo for ~100ms, then it disappeared, then reappeared/disappeared around four times (you can see the original issue I opened about on GitHub, <a href="https://github.com/godotengine/godot/issues/27583">here</a>).</p>
<p>The root cause of all this was multiple resources preloading the same script. I had a scene that preloaded <code>HelperScript.gd</code> and then <code>Second.tscn</code>; but <code>Second.tscn</code> also preloaded <code>HelperScript.gd</code>, causing the crash.</p>
<p>I found three different ways to address this problem:</p>
<ul>
<li><strong>Use singletons.</strong> Instead of preloading <code>HelperScript.gd</code> everywhere, I simply added it to the list of auto-loaded singletons in Godot. Problem solved. (This solution also makes sense, because I needed the same common method from <code>HelperScript.gd</code>.)</li>
<li><strong>Use <code>load</code> instead of <code>preload</code>.</strong> This makes me think <code>preload</code> is bugged; calling <code>load</code> succeeds without any issues. Obviously, this has performance implications - you may <em>want</em> to preload your entire game at startup time.</li>
<li><strong>Refactor.</strong> In my case, I needed a common function from a shared script. What if I used the same file, but two different functions? Perhaps I could split <code>HelperScript.gd</code> into two different scripts, and just load what I need instead.</li>
</ul>
<p>If you find your Godot game crashes on startup without explanation, maybe this is something you can investigate. (Failing that, go for a <code>git bisect</code> and try to isolate the commit that broke everything.)</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    <li>
                        <article>
                            <header>
                                <h1 class="entry-title">
                                    <a href="https://www.deengames.com/blog/2019/text-rendering-performance-check-for-a-reactjs-ascii-roguelike.html" rel="bookmark" title="Permalink to Text Rendering Performance Check for a ReactJS ASCII Roguelike">
                                       Text Rendering Performance Check for a ReactJS ASCII Roguelike
                                    </a>
                                </h1>
                            </header>
                            <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://www.deengames.com/blog/author/nightblade.html">nightblade</a>
    </address>

    in <a href="https://www.deengames.com/blog/category/other.html">Other</a>

    on 2019-03-19




    
</footer><!-- /.post-info -->                                <p>Tags: ReactJS, Roguelike</p>
<p><img alt="image" src="https://i.imgur.com/bMgMS3E.gif"></p>
<p>Recently, I was tasked with learning ReactJS (or just "React"). So, I made the most obvious choice possible: I decided to write an ASCII roguelike, which uses React as the front-end.</p>
<h2>Why an ASCII Roguelike?</h2>
<p>Why? For several, obvious reasons:</p>
<ul>
<li>I have very limited time to work on this; perhaps as little as one hour a day, or less.</li>
<li>ASCII roguelikes require little beyond a good monospace font -- no complex graphics, very simple animations</li>
<li>I enjoy creating roguelikes. It's fun. Fun motivates me to work on this, which fuels my learning.</li>
<li>Having created several (failed/incomplete) roguelikes in the past, I know how to code them. I don't have to think too hard about level generation algorithms, line-of-sight (or area-of-sight) lighting, etc. so I can focus on the technology.</li>
</ul>
<p>I set out to create, in my mind, the first step of any text roguelike: draw text on the screen <em>really fast</em> and see how it performs. HTML should render at lightning-speed in my modern browser, right?</p>
<p>Wrong.</p>
<h2>The Simplest Possible Performance Test</h2>
<p>React is just a front-end technology; it doesn't dictate how I should structure my HTML. With that in mind, I set out to answer two questions:</p>
<ul>
<li>What kind of performance can I expect with my roguelike?</li>
<li>What factors affect performance? Does changing the font, applying colour (or not), using nested <code>div</code> tags vs. <code>span</code> tags, etc. make any difference?</li>
</ul>
<p>In brief, the answer to question #2 ended up being "no." Performance bottlenecks on something else entirely; none of those changes make any significant difference.</p>
<p>I wrote a little Javascript that tests exactly what I want:</p>
<ul>
<li>Define dimensions of the screen. In this case, 50x16 tiles.</li>
<li>Create a <code>div</code> tag for each tile. Style it appropriately (eg. width/height big enough to fit any character)</li>
<li>Very frequently (like, 60 times per second), update each tile's display to a random character with a random colour.</li>
</ul>
<p>You can see the code, more or less (with FPS counting),  <a href="https://github.com/nightblade9/space-marine-junaid/blob/master/prototypes/1-dom-performance/index.html">here</a>.  It's simple, and to the point.</p>
<h2>The Results</h2>
<p>In a word: abysmal! On my fairly beefy dev machine (lots of RAM, good CPU, mediocre GPU), it renders at a measly 6-7FPS. You can see the results <a href="https://twitter.com/nightblade99/status/1098278413935280128">in this tweet</a>.</p>
<p>As I mentioned earlier, I tried several variations; none of them improve performance, at all. The core of it comes down to a call to set the character itself. Pseudocode:</p>
<div class="highlight"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="k">character</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">tile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">tiles</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="n">tile</span><span class="p">.</span><span class="n">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">character</span><span class="w"></span>
</code></pre></div>

<p>It turns out that browsers, even modern ones, even on beefy hardware, are <em>really, really slow</em> when you set <code>innerText</code>. The only alternative - using <code>innerHTML</code> -- is slower, and probably broken on Internet Explorer.</p>
<h3>The Conclusion</h3>
<p>For an ASCII roguelike without too much going on, 6FPS is probably enough. If I really cared about performance, I could switch to canvas-rendering and a bitmap font (lots of work and not sure how it works with React), or using images - either images of text, or real images.</p>
<p>For me, the goal is to learn ReactJS, so I plan to continue forward with this as-is, without major surgery.</p>
                            </div><!-- /.entry-content -->
                            <hr/>
                        </article>
                    </li>
                    </ol><!-- /#posts-list -->
<p class="paginator">
        <a href="https://www.deengames.com/blog/index.html">&#8647;</a>
        <a href="https://www.deengames.com/blog/index.html">&laquo;</a>
    Page 2 / 5
        <a href="https://www.deengames.com/blog/index3.html">&raquo;</a>
        <a href="https://www.deengames.com/blog/index5.html">&#8649;</a>
</p>
                </section><!-- /#content -->
</div>
                </div>
            </div>
            <!-- start sidebar -->
            <div class="span3">
                <section id="sidebar">
                    <div>
                        <h2>Browse content by</h2>
                        <ul class="fa-ul">
                        <li><a href="https://www.deengames.com/blog/categories.html"><i class="fa-li fa fa-tags"></i> Categories</a></li>
                        <li><a href="https://www.deengames.com/blog/archives.html"><i class="fa-li fa fa-calendar"></i> Dates</a></li>
                        <li><a href="https://www.deengames.com/blog/tags.html"><i class="fa-li fa fa-tag"></i> Tags</a></li>
            
                        <li><a href="/feeds/atom.xml"><i class="fa-li fa fa-rss"></i> Feed</a></li>
                        </ul>
                    </div><!-- /.browse -->
                    <div>
                        <h2>Links</h2>
                        <ul>
                            <li><a href="https://www.deengames.com">All Games</a></li>
                            <li><a href="https://www.getrevue.co/profile/deengames">Newsletter</a></li>
                            <li><a href="https://discord.gg/5D6XS3b">Discord Community</a></li>
                        </ul>
                    </div><!-- /.Links -->
                    <div>
                        <h2>Social</h2>
                        <ul>
                            <li><a href="https://twitter.com/nightblade99">Twitter</a></li>
                        </ul>
                    </div><!-- /.social -->
<!-- /.Tags -->
                </section><!-- /#sidebar -->
            </div>
            <!-- end sidebar -->
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            Copyright &copy; NightBlade, 2018+. All rights reserved.
        </div>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11092514-7']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>